<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Spatially Convergent Partial Cross Mapping • spEDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Spatially Convergent Partial Cross Mapping">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spEDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.12</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/main1_pkgintro.html">1. Introduction to the spEDM package</a></li>
    <li><a class="dropdown-item" href="../articles/main2_ssr.html">2. State Space Reconstruction</a></li>
    <li><a class="dropdown-item" href="../articles/main3_gccm.html">3. Geographical Convergent Cross Mapping</a></li>
    <li><a class="dropdown-item" href="../articles/main4_gpc.html">4. Geographical Pattern Causality</a></li>
    <li><a class="dropdown-item" href="../articles/main5_gcmc.html">5. Geographical Cross Mapping Cardinality</a></li>
    <li><a class="dropdown-item" href="../articles/main6_scpcm.html">6. Spatially Convergent Partial Cross Mapping</a></li>
    <li><a class="dropdown-item" href="../articles/si1_slm.html">SI1. Spatial Logistic Map</a></li>
    <li><a class="dropdown-item" href="../articles/si2_sct.html">SI2. Spatial Causality Test</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stscl/spEDM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Spatially Convergent Partial Cross Mapping</h1>
                        <h4 data-toc-skip class="author">Wenbo Lv</h4>
            
            <h4 data-toc-skip class="date"><div class="line-block">Last
update: 2026-02-01<br>
Last run: 2026-02-02</div></h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stscl/spEDM/blob/main/vignettes/main6_scpcm.Rmd" class="external-link"><code>vignettes/main6_scpcm.Rmd</code></a></small>
      <div class="d-none name"><code>main6_scpcm.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="model-principles">Model principles<a class="anchor" aria-label="anchor" href="#model-principles"></a>
</h2>
<p>The methodological details are pending peer review and will be made
available thereafter.</p>
</div>
<div class="section level2">
<h2 id="usage-examples">Usage examples<a class="anchor" aria-label="anchor" href="#usage-examples"></a>
</h2>
<div class="section level3">
<h3 id="example-of-spatial-vector-data">Example of spatial vector data<a class="anchor" aria-label="anchor" href="#example-of-spatial-vector-data"></a>
</h3>
<p>Load the <code>spEDM</code> package and columbus OH spatial analysis
dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"spEDM"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"spEDM"</span><span class="op">)</span></span>
<span><span class="co">## Loading required namespace: spEDM</span></span>
<span></span>
<span><span class="va">columbus</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"case/columbus.gpkg"</span>, package<span class="op">=</span><span class="st">"spEDM"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">columbus</span></span>
<span><span class="co">## Simple feature collection with 49 features and 6 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 5.874907 ymin: 10.78863 xmax: 11.28742 ymax: 14.74245</span></span>
<span><span class="co">## Projected CRS: Undefined Cartesian SRS with unknown unit</span></span>
<span><span class="co">## # A tibble: 49 × 7</span></span>
<span><span class="co">##    hoval   inc  crime  open plumb discbd                                     geom</span></span>
<span><span class="co">##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;                                &lt;POLYGON&gt;</span></span>
<span><span class="co">##  1  80.5 19.5  15.7   2.85  0.217   5.03 ((8.624129 14.23698, 8.5597 14.74245, 8…</span></span>
<span><span class="co">##  2  44.6 21.2  18.8   5.30  0.321   4.27 ((8.25279 14.23694, 8.282758 14.22994, …</span></span>
<span><span class="co">##  3  26.4 16.0  30.6   4.53  0.374   3.89 ((8.653305 14.00809, 8.81814 14.00205, …</span></span>
<span><span class="co">##  4  33.2  4.48 32.4   0.394 1.19    3.7  ((8.459499 13.82035, 8.473408 13.83227,…</span></span>
<span><span class="co">##  5  23.2 11.3  50.7   0.406 0.625   2.83 ((8.685274 13.63952, 8.677577 13.72221,…</span></span>
<span><span class="co">##  6  28.8 16.0  26.1   0.563 0.254   3.78 ((9.401384 13.5504, 9.434411 13.69427, …</span></span>
<span><span class="co">##  7  75    8.44  0.178 0     2.40    2.74 ((8.037741 13.60752, 8.062716 13.60452,…</span></span>
<span><span class="co">##  8  37.1 11.3  38.4   3.48  2.74    2.89 ((8.247527 13.58651, 8.2795 13.5965, 8.…</span></span>
<span><span class="co">##  9  52.6 17.6  30.5   0.527 0.891   3.17 ((9.333297 13.27242, 9.671007 13.27361,…</span></span>
<span><span class="co">## 10  96.4 13.6  34.0   1.55  0.558   4.33 ((10.08251 13.03377, 10.0925 13.05275, …</span></span>
<span><span class="co">## # ℹ 39 more rows</span></span></code></pre></div>
<p>We demonstrate how spatial vector data can be used in SCPCM analysis
through a causal example examining the influences of the level of
burglary incidents in a neighbourhood on house values, with
neighbourhood household income included as a conditioning variable.</p>
<p>Determine minimum embedding dimensions:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/fnn.html">fnn</a></span><span class="op">(</span><span class="va">columbus</span>,<span class="st">"crime"</span>,E <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">##        E:1        E:2        E:3        E:4        E:5        E:6        E:7 </span></span>
<span><span class="co">## 0.79591837 0.53061224 0.63265306 0.51020408 0.12244898 0.04081633 0.00000000 </span></span>
<span><span class="co">##        E:8 </span></span>
<span><span class="co">## 0.00000000</span></span>
<span><span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/fnn.html">fnn</a></span><span class="op">(</span><span class="va">columbus</span>,<span class="st">"hoval"</span>,E <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">##        E:1        E:2        E:3        E:4        E:5        E:6        E:7 </span></span>
<span><span class="co">## 0.85714286 0.77551020 0.51020408 0.61224490 0.22448980 0.08163265 0.00000000 </span></span>
<span><span class="co">##        E:8 </span></span>
<span><span class="co">## 0.00000000</span></span>
<span><span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/fnn.html">fnn</a></span><span class="op">(</span><span class="va">columbus</span>,<span class="st">"inc"</span>,E <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">##        E:1        E:2        E:3        E:4        E:5        E:6        E:7 </span></span>
<span><span class="co">## 0.73469388 0.24489796 0.30612245 0.38775510 0.24489796 0.04081633 0.00000000 </span></span>
<span><span class="co">##        E:8 </span></span>
<span><span class="co">## 0.00000000</span></span></code></pre></div>
<p>Self prediction for parameter turning:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/simplex.html">simplex</a></span><span class="op">(</span><span class="va">columbus</span>,<span class="st">"crime"</span>,<span class="st">"crime"</span>,E <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">10</span>,k<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">## The suggested E,k,tau for variable crime is 8, 12 and 1</span></span>
<span><span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/simplex.html">simplex</a></span><span class="op">(</span><span class="va">columbus</span>,<span class="st">"hoval"</span>,<span class="st">"hoval"</span>,E <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">10</span>,k<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">## The suggested E,k,tau for variable hoval is 7, 12 and 1</span></span>
<span><span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/simplex.html">simplex</a></span><span class="op">(</span><span class="va">columbus</span>,<span class="st">"inc"</span>,<span class="st">"inc"</span>,E <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">10</span>,k<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">## The suggested E,k,tau for variable inc is 8, 12 and 1</span></span></code></pre></div>
<p>Conduct SCPCM:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crime_hoval</span> <span class="op">=</span> <span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/scpcm.html">scpcm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">columbus</span>,</span>
<span>                           cause <span class="op">=</span> <span class="st">"crime"</span>,</span>
<span>                           effect <span class="op">=</span> <span class="st">"hoval"</span>,</span>
<span>                           conds <span class="op">=</span> <span class="st">"inc"</span>,</span>
<span>                           libsizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">45</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                           E <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">7</span>,<span class="fl">8</span><span class="op">)</span>,</span>
<span>                           k <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                           progressbar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">crime_hoval</span></span>
<span><span class="co">## -------------------------------------- </span></span>
<span><span class="co">## ***partial cross mapping prediction*** </span></span>
<span><span class="co">## -------------------------------------- </span></span>
<span><span class="co">##   libsizes crime-&gt;hoval hoval-&gt;crime</span></span>
<span><span class="co">## 1        5   0.08948688  0.022401607</span></span>
<span><span class="co">## 2       10   0.14511673  0.062986079</span></span>
<span><span class="co">## 3       15   0.16849249  0.080653365</span></span>
<span><span class="co">## 4       20   0.20940427  0.040974217</span></span>
<span><span class="co">## 5       25   0.23160147  0.026613757</span></span>
<span><span class="co">## 6       30   0.24709326  0.001942294</span></span>
<span><span class="co">## 7       35   0.29707812 -0.014879976</span></span>
<span><span class="co">## 8       40   0.33591810 -0.028758126</span></span>
<span><span class="co">## 9       45   0.36337200 -0.040204136</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ------------------------------ </span></span>
<span><span class="co">## ***cross mapping prediction*** </span></span>
<span><span class="co">## ------------------------------ </span></span>
<span><span class="co">##   libsizes crime-&gt;hoval hoval-&gt;crime</span></span>
<span><span class="co">## 1        5    0.2224861    0.1378071</span></span>
<span><span class="co">## 2       10    0.3023880    0.1880328</span></span>
<span><span class="co">## 3       15    0.4005255    0.2085278</span></span>
<span><span class="co">## 4       20    0.4681692    0.2203727</span></span>
<span><span class="co">## 5       25    0.5098130    0.2293076</span></span>
<span><span class="co">## 6       30    0.5467173    0.2326005</span></span>
<span><span class="co">## 7       35    0.5732757    0.2331852</span></span>
<span><span class="co">## 8       40    0.5822545    0.2361204</span></span>
<span><span class="co">## 9       45    0.5883504    0.2364234</span></span></code></pre></div>
<p>Visualize the result:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"cowplot"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"cowplot"</span><span class="op">)</span></span>
<span><span class="co">## Loading required namespace: cowplot</span></span>
<span></span>
<span><span class="va">fig1a</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">crime_hoval</span>,partial <span class="op">=</span> <span class="cn">FALSE</span>,ylimits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fig1b</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">crime_hoval</span>,partial <span class="op">=</span> <span class="cn">TRUE</span>,ylimits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.55</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fig1</span> <span class="op">=</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">fig1a</span>,<span class="va">fig1b</span>,ncol <span class="op">=</span> <span class="fl">2</span>,label_fontfamily <span class="op">=</span> <span class="st">'serif'</span>,</span>
<span>                          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'('</span>,<span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,<span class="st">')'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fig1</span></span></code></pre></div>
<div class="float">
<img src="../reference/figures/scpcm/fig1-1.png" alt="Figure 1. The cross mapping between crime and house value. a Crime–hoval causality without accounting for covariates. b Crime–hoval causality controlling for household income."><div class="figcaption">
<strong>Figure 1</strong>. The cross mapping
between crime and house value. <strong>a</strong> Crime–hoval causality
without accounting for covariates. <strong>b</strong> Crime–hoval
causality controlling for household income.</div>
</div>
<p><br></p>
</div>
<div class="section level3">
<h3 id="example-of-spatial-raster-data">Example of spatial raster data<a class="anchor" aria-label="anchor" href="#example-of-spatial-raster-data"></a>
</h3>
<p>Load the <code>spEDM</code> package and simulate raster data with a
cyclic interaction structure <span class="math inline">\(x \rightarrow y
\rightarrow z \rightarrow x\)</span>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"fields"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"fields"</span><span class="op">)</span></span>
<span><span class="co">## Loading required namespace: fields</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"MASS"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"MASS"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_trispecies</span> <span class="op">=</span> \<span class="op">(</span><span class="va">nx</span>,<span class="va">ny</span>,<span class="va">seed</span> <span class="op">=</span> <span class="fl">123</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">grid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="va">nx</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="va">ny</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">cov.fun</span> <span class="op">=</span> \<span class="op">(</span><span class="va">d</span>, <span class="va">range</span> <span class="op">=</span> <span class="fl">1.5</span>, <span class="va">sill</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="va">sill</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">d</span><span class="op">/</span><span class="va">range</span><span class="op">)</span></span>
<span>  <span class="va">dist.mat</span> <span class="op">=</span> <span class="fu">fields</span><span class="fu">::</span><span class="fu">rdist</span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span>  <span class="va">cov.mat</span> <span class="op">=</span> <span class="fu">cov.fun</span><span class="op">(</span><span class="va">dist.mat</span>, range<span class="op">=</span><span class="fl">1.5</span>, sill<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">3</span>, <span class="op">{</span></span>
<span>    <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span>, <span class="va">cov.mat</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">sdsfun</span><span class="fu">::</span><span class="fu"><a href="https://stscl.github.io/sdsfun/reference/normalize_vector.html" class="external-link">normalize_vector</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nx</span>, ncol <span class="op">=</span> <span class="va">ny</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">species</span> <span class="op">=</span> <span class="fu">sim_trispecies</span><span class="op">(</span><span class="fl">20</span>,<span class="fl">20</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">=</span> <span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/slm.html">slm</a></span><span class="op">(</span><span class="va">species</span>, x <span class="op">=</span> <span class="st">"x"</span>, y <span class="op">=</span> <span class="st">"y"</span>, z <span class="op">=</span> <span class="st">"z"</span>, k <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                 step <span class="op">=</span> <span class="fl">15</span>, transient <span class="op">=</span> <span class="fl">1</span>, threshold <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>                 aggregate_fn <span class="op">=</span> \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                 alpha_x <span class="op">=</span> <span class="fl">0.05</span>, alpha_y <span class="op">=</span> <span class="fl">0.05</span>, alpha_z <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                 beta_xy <span class="op">=</span> <span class="fl">1</span>, beta_xz <span class="op">=</span> <span class="fl">0</span>, beta_yx <span class="op">=</span> <span class="fl">0</span>, beta_yz <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                 beta_zx <span class="op">=</span> <span class="fl">1</span>, beta_zy <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">species</span><span class="op">[[</span><span class="st">"x"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">=</span> <span class="va">sim</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">species</span><span class="op">[[</span><span class="st">"y"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">=</span> <span class="va">sim</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">species</span><span class="op">[[</span><span class="st">"z"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">=</span> <span class="va">sim</span><span class="op">$</span><span class="va">z</span></span>
<span><span class="va">species</span></span>
<span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## size        : 20, 20, 3  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">## extent      : 0, 20, 0, 20  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. :  </span></span>
<span><span class="co">## source(s)   : memory</span></span>
<span><span class="co">## names       :         x,         y,        z </span></span>
<span><span class="co">## min values  : 0.9984091, 0.9983558, 0.998285 </span></span>
<span><span class="co">## max values  : 1.0009110, 1.0011445, 1.001050</span></span></code></pre></div>
<p>Determine minimum embedding dimensions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/fnn.html">fnn</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="co">##       E:1       E:2       E:3       E:4       E:5       E:6       E:7       E:8 </span></span>
<span><span class="co">## 0.8937824 0.3125000 0.0100000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 </span></span>
<span><span class="co">##       E:9 </span></span>
<span><span class="co">## 0.0000000</span></span>
<span><span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/fnn.html">fnn</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="co">##       E:1       E:2       E:3       E:4       E:5       E:6       E:7       E:8 </span></span>
<span><span class="co">## 0.9333333 0.2525000 0.0425000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 </span></span>
<span><span class="co">##       E:9 </span></span>
<span><span class="co">## 0.0000000</span></span>
<span><span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/fnn.html">fnn</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"z"</span><span class="op">)</span></span>
<span><span class="co">##       E:1       E:2       E:3       E:4       E:5       E:6       E:7       E:8 </span></span>
<span><span class="co">## 0.9238845 0.3375000 0.0625000 0.0200000 0.0000000 0.0000000 0.0000000 0.0000000 </span></span>
<span><span class="co">##       E:9 </span></span>
<span><span class="co">## 0.0000000</span></span></code></pre></div>
<p>Self prediction for parameter turning:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">=</span> <span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/simplex.html">simplex</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"x"</span>, <span class="st">"x"</span>, E <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">10</span>, k <span class="op">=</span> <span class="fl">15</span>, tau <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">s2</span> <span class="op">=</span> <span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/simplex.html">simplex</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"y"</span>, <span class="st">"y"</span>, E <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">10</span>, k <span class="op">=</span> <span class="fl">15</span>, tau <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">s3</span> <span class="op">=</span> <span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/simplex.html">simplex</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"z"</span>, <span class="st">"z"</span>, E <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">10</span>, k <span class="op">=</span> <span class="fl">15</span>, tau <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">s1</span>,<span class="va">s2</span>,<span class="va">s3</span><span class="op">)</span></span>
<span><span class="co">## [[1]]</span></span>
<span><span class="co">## The suggested E,k,tau for variable x is 7, 15 and 1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## The suggested E,k,tau for variable y is 9, 15 and 1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## The suggested E,k,tau for variable z is 5, 15 and 1</span></span></code></pre></div>
<p>Due to the statistical aggregation performed after simulating with
the spatial logistic map, we adopt a uniform embedding dimension for x,
y, and z to reduce inference bias:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"purrr"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"purrr"</span><span class="op">)</span></span>
<span><span class="co">## Loading required namespace: purrr</span></span>
<span><span class="va">simplex_res</span> <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map2_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">s1</span>,<span class="va">s2</span>,<span class="va">s3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span>,</span>
<span>                              \<span class="op">(</span><span class="va">.list</span>,<span class="va">.name</span><span class="op">)</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">.list</span><span class="op">$</span><span class="va">xmap</span>,variable <span class="op">=</span> <span class="va">.name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simplex_res</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">E</span>, y <span class="op">=</span> <span class="va">rho</span>, color <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="../reference/figures/scpcm/fig2-1.png" alt="Figure 2. Self cross prediction skills for three variables."><div class="figcaption">
<strong>Figure 2</strong>. Self cross prediction
skills for three variables.</div>
</div>
<p><br></p>
<p>Since the self-prediction performance of the y variable is relatively
weaker than that of x and z, we select the embedding dimension that
yields the strongest predictive performance for y as the final
dimension, that is <span class="math inline">\(E = 9\)</span>.</p>
<p>Investigate the causation between x and z, with y as control
variables:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xz</span> <span class="op">=</span> <span class="fu">spEDM</span><span class="fu">::</span><span class="fu"><a href="../reference/scpcm.html">scpcm</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"x"</span>, <span class="st">"z"</span>, <span class="st">"y"</span>, E <span class="op">=</span> <span class="fl">9</span>, k <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                  libsizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">400</span>,<span class="fl">50</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                  progressbar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">xz</span></span>
<span><span class="co">## -------------------------------------- </span></span>
<span><span class="co">## ***partial cross mapping prediction*** </span></span>
<span><span class="co">## -------------------------------------- </span></span>
<span><span class="co">##   libsizes       x-&gt;z      z-&gt;x</span></span>
<span><span class="co">## 1       50 0.07977338 0.1020714</span></span>
<span><span class="co">## 2      100 0.10473775 0.1762694</span></span>
<span><span class="co">## 3      150 0.14175015 0.1959109</span></span>
<span><span class="co">## 4      200 0.20562278 0.2543825</span></span>
<span><span class="co">## 5      250 0.25500417 0.3300376</span></span>
<span><span class="co">## 6      300 0.27904324 0.3956866</span></span>
<span><span class="co">## 7      350 0.31249554 0.4597477</span></span>
<span><span class="co">## 8      400 0.28091955 0.4843444</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ------------------------------ </span></span>
<span><span class="co">## ***cross mapping prediction*** </span></span>
<span><span class="co">## ------------------------------ </span></span>
<span><span class="co">##   libsizes      x-&gt;z      z-&gt;x</span></span>
<span><span class="co">## 1       50 0.1542880 0.1368370</span></span>
<span><span class="co">## 2      100 0.1827606 0.2217753</span></span>
<span><span class="co">## 3      150 0.2426258 0.2781118</span></span>
<span><span class="co">## 4      200 0.3239733 0.3487456</span></span>
<span><span class="co">## 5      250 0.4035323 0.4185710</span></span>
<span><span class="co">## 6      300 0.4653763 0.4835619</span></span>
<span><span class="co">## 7      350 0.5190529 0.5553776</span></span>
<span><span class="co">## 8      400 0.5658039 0.5938894</span></span></code></pre></div>
<p>Visualize the result:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig2a</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xz</span>,partial <span class="op">=</span> <span class="cn">FALSE</span>,ylimits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.65</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fig2b</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xz</span>,partial <span class="op">=</span> <span class="cn">TRUE</span>,ylimits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.65</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fig2</span> <span class="op">=</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu">plot_grid</span><span class="op">(</span><span class="va">fig2a</span>,<span class="va">fig2b</span>,ncol <span class="op">=</span> <span class="fl">2</span>,label_fontfamily <span class="op">=</span> <span class="st">'serif'</span>,</span>
<span>                          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'('</span>,<span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,<span class="st">')'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fig2</span></span></code></pre></div>
<div class="float">
<img src="../reference/figures/scpcm/fig3-1.png" alt="Figure 3. The cross mapping between x and z. a x–z causality without accounting for y. b x–z causality controlling for y."><div class="figcaption">
<strong>Figure 3</strong>. The cross mapping
between x and z. <strong>a</strong> x–z causality without accounting for
y. <strong>b</strong> x–z causality controlling for y.</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://spatlyu.github.io/" class="external-link">Wenbo Lv</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
