---
title: "State Space Reconstruction (SSR)"
author: "Wenbo Lv"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{SSR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "##",
  fig.path = "man/figures/ssr/"
)
```

## Spatial State Space Reconstruction (S-SSR)

当然！以下是将你提供的“原理陈述”和“实际操作”内容有机整合后的英文版本，适合放入 R 包 vignette 的 *Model Principle*（模型原理）章节中。整体逻辑清晰，术语规范，并具有一定的教程风格：

---

## Model Principle

Takens’ theory proves that for a dynamical system $\phi$, if its trajectory converges to an attractor manifold $M$—a bounded and invariant set of states—then there exists a smooth mapping between the system $\phi$ and its attractor $M$. Consequently, the time series observations of $\phi$ can be used to reconstruct the structure of $M$ through delay embedding.

According to the generalized embedding theorem, for a compact $d$-dimensional manifold $M$ and a set of observation functions $\langle h_1, h_2, \ldots, h_L \rangle$, the mapping $\psi_{\phi,h}(x) = \langle h_1(x), h_2(x), \ldots, h_L(x) \rangle$ is an embedding of $M$ when $L \geq 2d + 1$. Here, *embedding* refers to a one-to-one map that resolves all singularities of the original manifold. The observation functions $h_i$ can take the form of time-lagged values from a single time series, lags from multiple time series, or even completely distinct measurements. The former two are simply special cases of the third.

This embedding framework can be extended to *spatial cross-sectional data*, which lack temporal ordering but are observed over a spatial domain. In this context, the observation functions can be defined using the values of a variable at a focal spatial unit and its surrounding neighbors (known as *spatial lags* in spatial statistics). Specifically, for a spatial location $s$, the embedding can be written as:

$$
\psi(x, s) = \langle h_s(x), h_{s(1)}(x), \ldots, h_{s(L-1)}(x) \rangle,
$$

where $h_{s(i)}(x)$ denotes the observation function of the $i$-th order spatial lag unit relative to $s$. These spatial lags provide the necessary diversity of observations for effective manifold reconstruction. In practice, if a given spatial lag order involves multiple units, summary statistics such as the mean or directionally-weighted averages can be used as the observation function to maintain a one-to-one embedding.

## Usage examples

### An example of spatial lattice data

Load the `spEDM` package and its columbus OH spatial analysis dataset:

```{r load_lattice_data}
library(spEDM)

columbus = sf::read_sf(system.file("case/columbus.gpkg", package="spEDM"))
columbus
```

Embedding the variable `crime` from columbus OH spatial analysis dataset:

```{r embed_lattice_data}
v = embedded(columbus,"crime",E = 9,tau = 0,trend.rm = FALSE)
```

### An example of spatial grid data

Load the `spEDM` package and its soil pollution data:

```{r load_grid_data}
library(spEDM)

cu = terra::rast(system.file("case/cu.tif", package="spEDM"))
cu
```

Embedding the variable `cu` from soil pollution data:

```{r embed_grid_data}
r = spEDM::embedded(cu,"cu",E = 9,tau = 0,trend.rm = FALSE)
```

## Determination of Embedding Dimension $E$ and Spatial Lag Step $\tau$
